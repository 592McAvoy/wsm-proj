<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <style>
        #search-area{
            padding-left: 20%;
            padding-right: 20%;
            padding-top: 200px;
            padding-bottom: 100px;
            background: url('/static/bgimg.jpg')
        }
    </style>
    <title>检索系统</title>
</head>
<body>

<div class="input-group" id='search-area' style="margin-bottom: 1em">

    <button style='border-top-right-radius: 0;
  border-bottom-right-radius: 0;' type="button" class="btn btn-light dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span class="sr-only">Toggle Dropdown</span>
    </button>
    <div class="dropdown-menu">
        <a class="dropdown-item example-btn" data-num='1' href="#">Example 1</a>
        <a class="dropdown-item example-btn" data-num='2' href="#">Example 2</a>
    </div>

    <input id="search-input" type="text" class="form-control" aria-label="Text input with segmented dropdown button">

    <!-- <button id='data-source-btn' type="button" style='border-radius:0; border: 0' class="btn btn-light">数据源1</button> -->

    <div class="input-group-append">
        <button id='search-btn' type="button" class="btn btn-primary">按排序方式1搜索</button>
        <button type="button" class="btn btn-info dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="sr-only">Toggle Dropdown</span>
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item search-type" href="#">按排序方式1搜索</a>
            <a class="dropdown-item search-type" href="#">按排序方式2搜索</a>
            <a class="dropdown-item search-type" href="#">按排序方式3搜索</a>
            <a class="dropdown-item search-type" href="#">按排序方式4搜索</a>
            <a class="dropdown-item search-type" href="#">按排序方式5搜索</a>
        </div>
    </div>


</div>

{% csrf_token %}

<div id='sort-line' style="padding-left:5%; margin-bottom:1em; display: none">根据<a href="#" id="sort-btn">案号</a>排序</div>
<center>
    <div id="display-area"></div>

{#    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">#}
{#        <div class="card-body">#}
            {#            <div class="float-right">民事 一审 判决</div>#}
{#            <h5 class="card-title">案号</h5>#}
{#            <p class="card-text">省份 执行法院 执行依据文号 做出执行依据单位</p>#}
{#            <p class="card-text">被执行人姓名或名称 [(若被执行人为公司) 法人 人员与公司关系 人员姓名 人员身份证号码] 性别 年龄 身份证号或组织机构代码</p>#}
{#            <p class="card-text">生效法律文书确定的义务</p>#}
{#            <p class="card-text">被执行人履行情况[履行部分/未履行部分] 被执行人行为具体情形</p>#}
{#            <p class="card-text">立案时间~发布时间</p>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">#}
{#        <div class="card-body">#}
            {#            <div class="float-right">民事 一审 判决</div>#}
{#            <h5 class="card-title"><div data-toggle="tooltip" data-placement="left" title="案号">(2006)津法民执字第01371号</div></h5>#}
{#            <p class="card-text">重庆 重庆市江津区人民法院 （2005）津民初字第3689号 江津市人民法院</p>#}
{#            <p class="card-text">王云兵 男 45岁 5102251970****653x</p>#}
{#            <p class="card-text">被告王云兵在本判决生效后5日内偿还原告江津市农村信用合作社先锋信用社借款本金1000元，利息242.58元（利息从借款之日起计算到2005年11月8日止）。\n诉讼费用560元，由被告王云兵负担。此款限被告王云兵在本判决生效后5日内向本院交纳。</p>#}
{#            <p class="card-text">全部未履行 其他有履行能力而拒不履行生效法律文书确定义务</p>#}
{#            <p class="card-text">2006年10月25日~2015年01月20日</p>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">#}
{#        <div class="card-body">#}
{#            <h5 class="card-title">案号</h5>#}
{#            <p class="card-text">申请执行人/被执行人 被执行人地址 被执行标的金额</p>#}
{#            <p class="card-text">承办法院、联系电话</p>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">#}
{#        <div class="card-body">#}
            {#            <div class="float-right">民事 一审 判决</div>#}
{#            <h5 class="card-title">（1997）崇执字第308号</h5>#}
{#            <p class="card-text">张大祥/龚飞 "被执行人地址" 11800元</p>#}
{#            <p class="card-text">崇明县人民法院\xa0\xa059614083</p>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">#}
        {#  <div class="card-header">Header</div>#}
{#        <div class="card-body">#}
{#            <div class="float-right">民事审判庭 一审 判决书</div>#}
{#            <h5 class="card-title"><a href="details_instrument?id=1">王雷与徐金林、江彪提供劳务者受害责任纠纷一审民事判决书</a></h5>#}
{#            <p class="card-text">提供劳务者受害责任纠纷\xa0 | （2017）沪0104民初19331号 | 2019-05-27</p>#}
{#            <p class="card-text">[法院观点]<br />#}
{#                原告：上海广得劳动服务有限公司，住所地上海市普陀区曹杨路XXX弄XXX号第5层510室。法定代表人：宗嘉平，总经理。委托诉讼代理人：崔申生，员工。委托诉讼代理人：张殷勤，上海信昌律师事务所律师。被告：...</p>#}
{#        </div>#}
{#    </div>#}
</center>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
{#<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>#}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script>
    $('.example-btn').click(function(){
        var search_type=$('#search-btn').html();
        var example_input='';
        var example_num=$(this).attr('data-num');
        if (search_type=="搜案件"){
            var data_source_text=$('#data-source-btn').text();
            if(data_source_text=='数据源1') {
                if (example_num == '1') {
                    example_input = '小明（person name） AND 上海（city）'
                }
                if (example_num == '2') {
                    example_input = '小明（person name） AND NOT 上海（city）'
                }
            }else{
                if (example_num=='1'){
                example_input='小明（person name） AND 上海（city） AND 上海徐汇人民法院（court name）'
                }
                if(example_num=='2'){
                    example_input='小明（person name） AND NOT 上海（city） AND (2017)沪0112执5984号'
                }
            }
        }
        else{
            if (example_num=='1'){
                example_input='该合同系双方真实意思表示，被告没有利用强势地位强行与原告签订合同。'
            }
            if(example_num=='2'){
                example_input='该合同并非双方真实意思表示，被告确系利用强势地位强行与原告签订合同。'
            }
        }
        $('#search-input').val(example_input);
    });
    function wrap_data(data, type=''){
        var template;
        if (type==1)
            template='    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">\n' +
                '        {#  <div class="card-header">Header</div>#}\n' +
                '        <div class="card-body">\n' +
                // '            <div class="float-right">{承办部门}{承办部门} {级别}{级别} {文书类别}{文书类别}</div>\n' +
                '            <h5 class="card-title"><a href="details?id={ID}" target="_blank">{title}{title}</a></h5>\n' +
                // '            <p class="card-text">{案由}{案由} | {案号}{案号} | {结案日期}{结案日期}</p>\n' +
                '            <p class="card-text">{content}{content}</p>\n' +
                '        </div>\n' +
                '    </div>';
        else if (type=='judge') {
            if (data['qysler'].length > 0) {
                template = "    <div class=\"card bg-light mb-3\" style=\"max-width: 80%;text-align: left;\">\n" +
                    "        <div class=\"card-body\">\n" +
                    "            {#            <div class=\"float-right\">民事 一审 判决</div>#}\n" +
                    "            <h5 class=\"card-title\">{案号}{caseCode}</h5>\n" +
                    "            <p class=\"card-text\">{省份}{areaName} {执行法院}{courtName} {执行依据文号}{gistId} {做出执行依据单位}{gistUnit}</p>\n" +
                    "            <p class=\"card-text\">{被执行人姓名或名称}{iname} {法人}{businessEntity} {人员与公司关系}{qysler.corporationtypename} {人员姓名}{qysler.iname} {人员身份证号码}{qysler.cardNum} {性别}{sexy} {年龄}{age}岁 {身份证号或组织机构代码}{cardNum}</p>\n" +
                    "            <p class=\"card-text\">{生效法律文书确定的义务}{duty}</p>\n" +
                    "            <p class=\"card-text\">{被执行人履行情况}{performance}[{履行部分}{performedPart}/{未履行部分}{unperformPart}] {被执行人行为具体情形}{disruptTypeName}</p>\n" +
                    "            <p class=\"card-text\">{立案时间}{regDate}~{发布时间}{publishDate}</p>\n" +
                    "        </div>\n" +
                    "    </div>";

            } else {
                template = "    <div class=\"card bg-light mb-3\" style=\"max-width: 80%;text-align: left;\">\n" +
                    "        <div class=\"card-body\">\n" +
                    "            {#            <div class=\"float-right\">民事 一审 判决</div>#}\n" +
                    "            <h5 class=\"card-title\">{案号}{caseCode}</h5>\n" +
                    "            <p class=\"card-text\">{省份}{areaName} {执行法院}{courtName} {执行依据文号}{gistId} {做出执行依据单位}{gistUnit}</p>\n" +
                    "            <p class=\"card-text\">{被执行人姓名或名称}{iname} {性别}{sexy} {年龄}{age} {身份证号或组织机构代码}{cardNum}</p>\n" +
                    "            <p class=\"card-text\">{生效法律文书确定的义务}{duty}</p>\n" +
                    "            <p class=\"card-text\">{被执行人履行情况}{performance}[{履行部分}{performedPart}/{未履行部分}{unperformPart}] {被执行人行为具体情形}{disruptTypeName}</p>\n" +
                    "            <p class=\"card-text\">{立案时间}{regDate}~{发布时间}{publishDate}</p>\n" +
                    "        </div>\n" +
                    "    </div>";
            }
        }
        else
            template='    <div class="card bg-light mb-3" style="max-width: 80%;text-align: left;">\n' +
                '        <div class="card-body">\n' +
                '            {#            <div class="float-right">民事 一审 判决</div>#}\n' +
                '            <h5 class="card-title">{案号}{案号}</h5>\n' +
                '            <p class="card-text">{申请执行人}{申请执行人}/{被执行人}{被执行人} {被执行人地址}{被执行人地址} {执行标的金额}{执行标的金额（元）}元</p>\n' +
                '            <p class="card-text">{承办法院、联系电话}{承办法院、联系电话}</p>\n' +
                '        </div>\n' +
                '    </div>';
        template = template.replace('{ID}', data['ID'])
        template = template.replace(/\{(.+?)}(\{.+?})/g, "<div style='display:inline' data-toggle=\"tooltip\" data-placement=\"left\" title=\"$1\">$2</div>");
        {#instrument过长内容截断#}
        var max_len=400;
        if(data['content'].length>max_len)
            data['content']=data['content'].substr(0,max_len)+"...";
        for (var key in data) {
            template = template.replace('{' + key + '}', data[key]==''? '无':data[key])
        }
        if ('qysler' in data)
            for (var key in data['qysler'][0]){
                template=template.replace('{qysler.' + key + '}', data['qysler'][0][key])
            }
        return template
    }
    $('.search-type').click(function(){
        $('#search-btn').html($(this).html());
        {#change data source btn#}
        var search_type=$(this).text();
        if (search_type=='搜文书') {
            $('#data-source-btn').css('display', 'none')
        }
        else{
            $('#data-source-btn').css('display', '')
        }
    });
    var type;
    $('#search-btn').click(function(){
        var search_type=$(this).text();
        {#do search#}
        var query_text=$('#search-input').val();
        // var data_source_text=$('#data-source-btn').text();
        // var dic={'数据源1':'judge','数据源2':'case'};
        {#var type;#}
        if (search_type=='按排序方式1搜索')
            type=1;
        else if (search_type=='按排序方式2搜索')
            type=2;
        else if (search_type=='按排序方式3搜索')
            type=3;
        else if (search_type=='按排序方式4搜索')
            type=4;
        else if (search_type=='按排序方式5搜索')
            type=5;
        if (query_text.trim()!=''){
            $('#sort-line').css("display","");
            $.ajax({
                url: '/search',
                type: 'post',
                data: {
                    csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
                    query: query_text,
                    type: type
                },
                success: function (data) {
                    $("#display-area").html('');
                    data=$.parseJSON(data);
                    console.log(data)
                    console.log(data.length)
                    for( i=0; i<data.length; i++){
                        $("#display-area").append(wrap_data(data[i],type))
                    }
                    $('[data-toggle="tooltip"]').tooltip()
                }
            })
        }
    });
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    });
    // $('#data-source-btn').click(function(){
    //     var cur=$(this).text();
    //     if (cur=='数据源1'){
    //         $('#data-source-btn').text('数据源2');
    //     }
    //     else
    //         $('#data-source-btn').text('数据源1');
    // });
    $('#sort-btn').click(function(){
        $.ajax({
            url: '/sort',
            type: 'post',
            data: {
                csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
            },
            success: function (data) {
                $("#display-area").html('');
                data=$.parseJSON(data);
                for( i=0; i<data.length; i++){
                    $("#display-area").append(wrap_data(data[i],type))
                }
                $('[data-toggle="tooltip"]').tooltip()
            }
        })
    });
</script>
</body>
</html>